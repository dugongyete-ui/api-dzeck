<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon(Nicoladipa).png') }}" type="image/x-icon">
    <title>API Explorer - Api Dzeck Ai</title>
    <style>
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { margin: 0; background: #212121; min-height: 100vh; color: #ececec; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        * { scrollbar-width: thin; scrollbar-color: #444 transparent; }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px 16px; }
        .header { display: flex; align-items: center; gap: 12px; padding: 10px 16px; border-bottom: 1px solid #2a2a2a; margin-bottom: 20px; background: #171717; border-radius: 0; margin: -20px -16px 20px -16px; padding: 10px 16px; }
        .header img { width: 36px; height: 36px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .header-text h1 { font-size: 28px; font-weight: 700; color: #ececec; margin: 0; }
        .header-text h2 { font-size: 14px; font-weight: 500; color: #00a896; margin: 0; }
        .nav-btns { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .nav-btn { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; color: white; text-decoration: none; border: none; cursor: pointer; transition: opacity 0.2s; }
        .nav-btn:hover { opacity: 0.85; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #00a896; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-info { background: #17a2b8; }
        .btn-secondary { background: #444; }
        .btn-warning { background: #fd7e14; }
        .section { background: #2b2b2b; border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid #333; }
        .section-title { font-size: 16px; font-weight: 700; color: #ececec; margin: 0 0 12px 0; display: flex; align-items: center; gap: 8px; }
        .form-group { margin-bottom: 14px; }
        .form-label { font-size: 13px; font-weight: 600; color: #d1d1d1; margin-bottom: 4px; display: block; }
        .form-select, .form-input { width: 100%; padding: 10px 12px; border: 1px solid #444; border-radius: 8px; font-size: 13px; background: #2f2f2f; color: #ececec; outline: none; transition: border-color 0.2s; }
        .form-select:focus, .form-input:focus { border-color: #00a896; box-shadow: 0 0 0 2px rgba(0,168,150,0.2); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .url-box { background: #1e1e2e; border: 1px solid #444; border-radius: 8px; padding: 12px 16px; font-family: 'Courier New', monospace; font-size: 13px; color: #d1d1d1; word-break: break-all; display: flex; align-items: center; gap: 8px; }
        .url-box .method-tag { background: #28a745; color: white; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 11px; flex-shrink: 0; }
        .copy-btn { background: #00a896; color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; flex-shrink: 0; }
        .copy-btn:hover { opacity: 0.8; }
        .curl-box { background: #1e1e2e; color: #4ec9b0; border-radius: 6px; padding: 12px; font-family: 'Courier New', monospace; font-size: 11px; white-space: pre-wrap; word-break: break-all; margin-top: 8px; border: 1px solid #333; }
        .result-box { background: #1e1e2e; color: #e0e0e0; border-radius: 8px; padding: 16px; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap; word-break: break-word; min-height: 60px; max-height: 400px; overflow-y: auto; border: 1px solid #333; }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; display: inline-block; }
        .badge-success { background: rgba(40,167,69,0.2); color: #28a745; }
        .badge-error { background: rgba(220,53,69,0.2); color: #dc3545; }
        .badge-pending { background: rgba(255,255,255,0.1); color: #888; }
        .badge-testing { background: rgba(253,126,20,0.2); color: #fd7e14; }
        .summary-box { background: rgba(0,168,150,0.1); border: 1px solid rgba(0,168,150,0.3); border-radius: 8px; padding: 14px; margin-bottom: 16px; }
        .summary-stats { display: flex; gap: 16px; flex-wrap: wrap; }
        .summary-stat { font-size: 13px; font-weight: 600; }
        .stat-total { color: #ececec; }
        .stat-success { color: #28a745; }
        .stat-error { color: #dc3545; }
        .stat-pending { color: #888; }
        .model-results-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .model-results-table th { text-align: left; font-size: 12px; font-weight: 700; color: #ececec; padding: 8px 10px; border-bottom: 2px solid #444; background: #2f2f2f; }
        .model-results-table td { font-size: 12px; padding: 8px 10px; border-bottom: 1px solid #333; color: #d1d1d1; }
        .model-results-table tr:hover { background: #353535; }
        .response-preview { max-width: 400px; max-height: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #888; font-size: 11px; }
        .progress-bar-bg { width: 100%; background: #333; border-radius: 6px; height: 8px; margin-top: 8px; }
        .progress-bar { height: 8px; border-radius: 6px; background: #28a745; transition: width 0.3s; }

        .model-info-card { background: #2f2f2f; border: 1px solid #444; border-radius: 10px; padding: 16px; margin-bottom: 14px; display: none; }
        .model-info-card .mi-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .model-info-card .mi-name { font-size: 18px; font-weight: 700; color: #00a896; }
        .model-info-card .mi-stars { font-size: 18px; color: #f5a623; letter-spacing: 2px; }
        .model-info-card .mi-tier { font-size: 11px; font-weight: 700; padding: 3px 10px; border-radius: 20px; color: white; }
        .tier-elite { background: linear-gradient(135deg, #f5a623, #e8880e); }
        .tier-strong { background: linear-gradient(135deg, #28a745, #1e7e34); }
        .tier-good { background: linear-gradient(135deg, #17a2b8, #117a8b); }
        .tier-basic { background: linear-gradient(135deg, #6c757d, #545b62); }
        .mi-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 8px; }
        .mi-tag { font-size: 10px; padding: 2px 8px; border-radius: 10px; background: rgba(255,255,255,0.08); color: #d1d1d1; border: 1px solid #444; font-weight: 600; }
        .mi-tag.good-coding { background: rgba(40,167,69,0.15); color: #28a745; border-color: rgba(40,167,69,0.3); }
        .mi-tag.good-reasoning { background: rgba(0,168,150,0.15); color: #00a896; border-color: rgba(0,168,150,0.3); }
        .mi-tag.fast { background: rgba(253,126,20,0.15); color: #fd7e14; border-color: rgba(253,126,20,0.3); }
        .mi-tag.search { background: rgba(255,255,255,0.08); color: #aaa; border-color: #444; }
        .mi-tag.budget { background: rgba(220,53,69,0.15); color: #dc3545; border-color: rgba(220,53,69,0.3); }
        .mi-desc { font-size: 12px; color: #aaa; line-height: 1.5; }

        .tab-btns { display: flex; gap: 4px; margin-bottom: 16px; border-bottom: 2px solid #333; padding-bottom: 0; }
        .tab-btn { padding: 10px 20px; border: none; background: none; font-size: 13px; font-weight: 600; color: #888; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .tab-btn:hover { color: #ececec; }
        .tab-btn.active { color: #00a896; border-bottom-color: #00a896; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        #curlModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; align-items: center; justify-content: center; }
        .curl-modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); }
        .curl-modal-content { position: relative; background: #2b2b2b; border: 1px solid #444; border-radius: 12px; padding: 20px; max-width: 620px; width: 92%; max-height: 85vh; overflow-y: auto; z-index: 1; }
        .curl-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .curl-modal-title { font-size: 16px; font-weight: 700; color: #ececec; }
        .curl-modal-body {}
        .curl-section { margin-bottom: 14px; }
        .curl-section-label { font-size: 12px; font-weight: 700; color: #d1d1d1; margin-bottom: 6px; }
        .curl-code-box { position: relative; background: #1e1e2e; color: #e0e8ea; border-radius: 8px; padding: 12px 50px 12px 12px; font-family: monospace; font-size: 12px; line-height: 1.6; word-break: break-all; white-space: pre-wrap; overflow-x: auto; border: 1px solid #333; }
        .curl-copy-btn { position: absolute; top: 8px; right: 8px; background: #00a896; color: white; border: none; border-radius: 6px; padding: 4px 12px; font-size: 11px; font-weight: 600; cursor: pointer; transition: background 0.2s; z-index: 2; }
        .curl-copy-btn:hover { background: #00c9b7; }
        .curl-copy-btn.copied { background: #28a745; }
        .curl-method-tag { display: inline-block; background: #28a745; color: white; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px; margin-right: 6px; }

        @media (max-width: 640px) {
            .form-row { grid-template-columns: 1fr; }
            .header { margin: -20px -16px 20px -16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="{{ url_for('static', filename='img/favicon(Nicoladipa).png') }}" alt="Logo">
            <div class="header-text">
                <div class="brand-name">
                    <span class="brand-api">API</span>
                    <span class="brand-dzeck" style="font-size:28px;">Dzeck</span>
                    <span class="brand-ai" style="font-size:28px;">Ai</span>
                </div>
                <h2>API Explorer</h2>
            </div>
        </div>

        <div class="nav-btns">
            <a href="/" class="nav-btn btn-primary">Chat</a>
            <a href="/models" class="nav-btn btn-secondary">Models</a>
            <a href="/settings" class="nav-btn btn-secondary">Settings</a>
            <span style="margin-left:auto;font-size:13px;color:#00a896;font-weight:600;display:flex;align-items:center;gap:6px;">
                Logged in as: <b>{{ username }}</b>
                {% if user_token %}
                | Token: <code style="background:rgba(0,168,150,0.15);padding:2px 8px;border-radius:4px;font-size:11px;cursor:pointer;color:#00a896;" onclick="navigator.clipboard.writeText('{{ user_token }}');this.style.background='rgba(40,167,69,0.2)';this.style.color='#28a745';setTimeout(()=>{this.style.background='rgba(0,168,150,0.15)';this.style.color='#00a896'},1000);" title="Click to copy">{{ user_token[:12] }}...</code>
                {% endif %}
            </span>
        </div>

        <div class="tab-btns">
            <button class="tab-btn active" onclick="switchTab('test')">Test API</button>
            <button class="tab-btn" onclick="switchTab('catalog')">Model Catalog</button>
        </div>

        <!-- TAB 1: TEST API -->
        <div id="tab-test" class="tab-content active">
            <div class="section">
                <h3 class="section-title">Test API</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Provider</label>
                        <select class="form-select" id="pgProvider" onchange="onProviderChange()">
                            {% for p in providers %}
                            <option value="{{ p }}">{{ p }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Model</label>
                        <select class="form-select" id="pgModel" onchange="onModelChange()"></select>
                    </div>
                </div>

                <div id="modelInfoCard" class="model-info-card"></div>

                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-input" id="pgMessage" rows="2" placeholder="Ketik pertanyaan..." oninput="updatePreview()">Hello, respond with one short sentence.</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Base URL + Model</label>
                    <div class="url-box">
                        <span class="method-tag">POST</span>
                        <span id="urlPreview" style="flex:1;"></span>
                        <button class="copy-btn" id="copyUrlBtn" onclick="copyText(document.getElementById('urlPreview').textContent, this)">Copy</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">cURL</label>
                    <div class="curl-box" id="curlPreview"></div>
                </div>

                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;">
                    <button onclick="runTest()" id="runBtn" class="nav-btn btn-success" style="padding:10px 24px;">Test 1 Model</button>
                    <button onclick="testAllModelsForProvider()" id="testAllModelsBtn" class="nav-btn btn-warning" style="padding:10px 18px;">Test Semua Model (1 Provider)</button>
                    <button onclick="testAllProviders()" id="testAllBtn" class="nav-btn btn-info" style="padding:10px 18px;font-weight:700;">Test SEMUA Provider &amp; Model (<span id="totalModelCount">...</span> total)</button>
                    <button onclick="stopAllTests()" id="stopBtn" class="nav-btn btn-danger" style="padding:10px 16px;display:none;">Stop</button>
                </div>
                <div style="font-size:11px;color:#888;margin-bottom:10px;">
                    <b>Test 1 Model</b> = test model yang dipilih di dropdown. 
                    <b>Test Semua Model</b> = test semua model dari provider yang dipilih. 
                    <b>Test SEMUA</b> = test 49 model dari 5 provider sekaligus.
                </div>

                <div class="form-group">
                    <div class="result-header">
                        <label class="form-label" style="margin:0;">Response</label>
                        <span id="pgStatus" class="status-badge badge-pending">Ready</span>
                    </div>
                    <div id="pgTime" style="font-size:11px;color:#999;margin-bottom:6px;"></div>
                    <div class="result-box" id="pgResult">Tekan "Execute Test" untuk mengirim request...</div>
                </div>
            </div>

            <div id="summarySection" class="section" style="display:none;">
                <h3 class="section-title">Summary Hasil Test</h3>
                <div class="summary-box">
                    <div class="summary-stats">
                        <span class="summary-stat stat-total">Total: <span id="sumTotal">0</span></span>
                        <span class="summary-stat stat-success">Success: <span id="sumSuccess">0</span></span>
                        <span class="summary-stat stat-error">Error: <span id="sumError">0</span></span>
                        <span class="summary-stat stat-pending">Pending: <span id="sumPending">0</span></span>
                    </div>
                    <div class="progress-bar-bg" style="margin-top:10px;">
                        <div class="progress-bar" id="sumProgress" style="width:0%;"></div>
                    </div>
                    <div id="sumProgressText" style="font-size:11px;color:#999;margin-top:4px;"></div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="model-results-table" id="resultsTable">
                        <thead>
                            <tr>
                                <th>Provider</th>
                                <th>Model</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Time</th>
                                <th>Response</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 2: MODEL CATALOG -->
        <div id="tab-catalog" class="tab-content">
            <div class="section">
                <h3 class="section-title">Model Catalog - Rating & Kemampuan</h3>
                <p style="font-size:12px;color:#666;margin:0 0 16px;">Rating berdasarkan benchmark coding (SWE-bench, Codeforces), kecerdasan umum, dan kemampuan menghasilkan kode panjang & kompleks.</p>

                <div id="catalogFilter" style="margin-bottom:14px;display:flex;gap:8px;flex-wrap:wrap;">
                    <button class="nav-btn btn-primary" onclick="filterCatalog('all')" style="padding:6px 14px;font-size:12px;">Semua</button>
                    <button class="nav-btn" onclick="filterCatalog(5)" style="padding:6px 14px;font-size:12px;background:#f5a623;">5 Bintang</button>
                    <button class="nav-btn" onclick="filterCatalog(4)" style="padding:6px 14px;font-size:12px;background:#28a745;">4 Bintang</button>
                    <button class="nav-btn" onclick="filterCatalog(3)" style="padding:6px 14px;font-size:12px;background:#17a2b8;">3 Bintang</button>
                    <button class="nav-btn" onclick="filterCatalog('coding')" style="padding:6px 14px;font-size:12px;background:#6f42c1;">Coding Expert</button>
                </div>

                <div style="overflow-x:auto;">
                    <table class="model-results-table" id="catalogTable">
                        <thead>
                            <tr>
                                <th>Provider</th>
                                <th>Model</th>
                                <th>Rating</th>
                                <th>Tier</th>
                                <th>Keunggulan</th>
                                <th>Deskripsi</th>
                            </tr>
                        </thead>
                        <tbody id="catalogBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
    const BASE_URL = '{{ base_url }}';
    const USER_TOKEN = '{{ user_token }}';
    const USERNAME = '{{ username }}';
    const PROVIDERS_MODELS = {{ providers_models | tojson }};
    (function() {
        var total = 0;
        Object.keys(PROVIDERS_MODELS).forEach(function(p) { total += (PROVIDERS_MODELS[p] || ['default']).length; });
        var el = document.getElementById('totalModelCount');
        if (el) el.textContent = total;
    })();
    let stopFlag = false;
    let allResults = [];

    const MODEL_RATINGS = {
        "PollinationsAI": {
            "openai":                   { stars: 4, tier: "Strong",  tags: ["coding", "general"],         desc: "Model GPT-4 level, serba bisa untuk coding dan percakapan umum" },
            "gpt-5-nano":               { stars: 3, tier: "Good",    tags: ["fast", "general"],            desc: "Versi ringan GPT-5, cepat tapi kurang detail untuk kode panjang" },
            "sonar-reasoning":          { stars: 4, tier: "Strong",  tags: ["reasoning", "search"],        desc: "Sonar versi reasoning - bisa analisis mendalam dengan data web" },
            "kimi-k2.5":               { stars: 3, tier: "Good",    tags: ["general", "coding"],          desc: "Model dari Moonshot AI, cukup baik untuk coding menengah" },
            "amazon-nova-micro":        { stars: 2, tier: "Basic",   tags: ["fast"],                       desc: "Model micro dari Amazon, sangat cepat tapi sangat terbatas" },
            "glm-5":                    { stars: 3, tier: "Good",    tags: ["general", "coding"],          desc: "Model dari Zhipu AI (China), kemampuan coding menengah" },
        },
        "TeachAnything": {
            "gemma":                    { stars: 2, tier: "Basic",   tags: ["general"],                    desc: "Model open-source kecil dari Google, terbatas tapi stabil" }
        },
        "Yqcloud": {
            "gpt-4":                    { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4 klasik via Yqcloud, masih kuat untuk coding dan umum" }
        },
        "Perplexity": {
            "auto":                     { stars: 4, tier: "Strong",  tags: ["search", "general"],          desc: "Auto-pilih model terbaik dari Perplexity" },
            "turbo":                    { stars: 4, tier: "Strong",  tags: ["fast", "search"],             desc: "Perplexity Turbo - jawaban cepat dengan search" },
            "gpt41":                    { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4.1 via Perplexity, sangat baik untuk coding" },
            "gpt5":                     { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "GPT-5 via Perplexity - model elite untuk segala tugas coding" },
            "gpt5_thinking":            { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "GPT-5 dengan mode thinking - analisis mendalam sebelum jawab" },
            "o3":                       { stars: 5, tier: "Elite",   tags: ["coding", "reasoning"],        desc: "OpenAI o3 - reasoning model sangat kuat untuk masalah kompleks" },
            "o3pro":                    { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "o3 Pro - versi terkuat reasoning, sempurna untuk arsitektur kode" },
            "claude2":                  { stars: 3, tier: "Good",    tags: ["general"],                    desc: "Claude 2 versi lama, masih cukup baik untuk umum" },
            "claude37sonnetthinking":   { stars: 4, tier: "Strong",  tags: ["coding", "reasoning"],        desc: "Claude 3.7 Sonnet dengan mode thinking" },
            "claude40opus":             { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "Claude Opus 4.0 - salah satu AI terpintar, ahli coding kompleks" },
            "claude40opusthinking":     { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "Claude Opus 4.0 Thinking - reasoning mendalam + coding elite" },
            "claude41opusthinking":     { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "Claude Opus 4.1 Thinking - versi terbaru, kemampuan coding tertinggi" },
            "claude45sonnet":           { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "Claude 4.5 Sonnet - benchmark #1 SWE-bench, raja coding!" },
            "claude45sonnetthinking":   { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "long-code"], desc: "Claude 4.5 Sonnet Thinking - yang terpintar + mode analisis" },
            "experimental":             { stars: 3, tier: "Good",    tags: ["general"],                    desc: "Model eksperimental Perplexity" },
            "grok":                     { stars: 4, tier: "Strong",  tags: ["general", "coding"],          desc: "Grok dari xAI, baik untuk coding dan percakapan" },
            "grok4":                    { stars: 5, tier: "Elite",   tags: ["coding", "reasoning"],        desc: "Grok 4 - model terkuat xAI, sangat pintar coding" },
            "gemini2flash":             { stars: 4, tier: "Strong",  tags: ["fast", "coding"],             desc: "Gemini 2 Flash - cepat dan pintar coding" },
            "pplx_pro":                 { stars: 4, tier: "Strong",  tags: ["search", "general"],          desc: "Perplexity Pro - pencarian mendalam dengan AI" },
            "pplx_pro_upgraded":        { stars: 4, tier: "Strong",  tags: ["search", "general"],          desc: "Perplexity Pro versi upgrade" },
            "pplx_alpha":               { stars: 3, tier: "Good",    tags: ["search"],                     desc: "Perplexity Alpha - model eksperimental" },
            "pplx_beta":                { stars: 3, tier: "Good",    tags: ["search"],                     desc: "Perplexity Beta - model dalam pengembangan" },
            "comet_max_assistant":       { stars: 3, tier: "Good",    tags: ["general"],                    desc: "Comet Max - asisten umum Perplexity" },
            "o3_research":              { stars: 5, tier: "Elite",   tags: ["reasoning", "search"],        desc: "o3 Research - reasoning + riset mendalam dari web" },
            "o3pro_research":           { stars: 5, tier: "Elite",   tags: ["reasoning", "search", "long-code"], desc: "o3 Pro Research - kombinasi terkuat reasoning + search" },
            "claude40sonnet_research":  { stars: 4, tier: "Strong",  tags: ["coding", "search"],           desc: "Claude 4 Sonnet Research - coding + riset web" },
            "claude40sonnetthinking_research": { stars: 5, tier: "Elite", tags: ["coding", "reasoning", "search"], desc: "Claude 4 Sonnet Thinking Research - analisis mendalam" },
            "claude40opus_research":    { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "search"], desc: "Claude Opus 4 Research - elite coding + riset" },
            "claude40opusthinking_research": { stars: 5, tier: "Elite", tags: ["coding", "reasoning", "search", "long-code"], desc: "Claude Opus 4 Thinking Research - yang tertinggi" },
            "o3_labs":                  { stars: 4, tier: "Strong",  tags: ["reasoning"],                  desc: "o3 Labs - reasoning eksperimental" },
            "o3pro_labs":               { stars: 5, tier: "Elite",   tags: ["reasoning", "coding"],        desc: "o3 Pro Labs - reasoning elite eksperimental" },
            "claude40sonnetthinking_labs": { stars: 4, tier: "Strong", tags: ["coding", "reasoning"],      desc: "Claude 4 Sonnet Thinking Labs - eksperimental" },
            "claude40opusthinking_labs": { stars: 5, tier: "Elite",  tags: ["coding", "reasoning"],        desc: "Claude Opus 4 Thinking Labs - elite eksperimental" },
            "o4mini":                   { stars: 4, tier: "Strong",  tags: ["fast", "reasoning"],          desc: "o4 Mini - reasoning cepat dan efisien" },
            "o1":                       { stars: 4, tier: "Strong",  tags: ["reasoning"],                  desc: "OpenAI o1 - reasoning model generasi pertama" },
            "gpt4o":                    { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4o - serba bisa, cepat, bagus coding" },
            "gpt45":                    { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4.5 - peningkatan dari GPT-4o" },
            "gpt4":                     { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4 klasik via Perplexity" },
            "o3mini":                   { stars: 4, tier: "Strong",  tags: ["fast", "reasoning"],          desc: "o3 Mini - reasoning cepat untuk tugas menengah" },
            "llama_x_large":            { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "LLaMA X Large - model open-source besar dari Meta" },
            "gemini":                   { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "Google Gemini via Perplexity" },
            "pplx_reasoning":           { stars: 4, tier: "Strong",  tags: ["reasoning", "search"],        desc: "Perplexity Reasoning - analisis mendalam" },
            "r1":                       { stars: 5, tier: "Elite",   tags: ["coding", "reasoning", "budget"], desc: "DeepSeek R1 - reasoning elite, setara o3, GRATIS!" }
        },
        "Auto": {
            "gpt-4":                    { stars: 4, tier: "Strong",  tags: ["coding", "general"],          desc: "GPT-4 auto-select provider terbaik" },
            "gpt-4o":                   { stars: 4, tier: "Strong",  tags: ["coding", "fast"],             desc: "GPT-4o auto-select - cepat dan pintar" },
            "gpt-4o-mini":              { stars: 3, tier: "Good",    tags: ["fast"],                       desc: "GPT-4o Mini auto-select - paling cepat dan hemat" }
        }
    };

    const BROKEN_MODELS = [
        {
            provider: "PollinationsAI", model: "claude-opus-4.6",
            cause: "provider", causeLabel: "Provider - Butuh Bayar",
            desc: "Model memerlukan akun berbayar di Anthropic. PollinationsAI tidak bisa mengakses tanpa API key valid. Bukan bug kode."
        },
        {
            provider: "PollinationsAI", model: "gemini-3-flash",
            cause: "provider", causeLabel: "Provider - Butuh Bayar",
            desc: "Google membatasi akses Gemini 3 Flash. Butuh API key Google Cloud berbayar. Bukan masalah kode."
        },
        {
            provider: "PollinationsAI", model: "midijourney",
            cause: "wrong-type", causeLabel: "Tipe Salah - Model Gambar",
            desc: "Ini adalah model generate gambar (Midjourney), bukan model text/chat. Sudah difilter dari daftar text models."
        },
        {
            provider: "PollinationsAI", model: "openai-audio",
            cause: "wrong-type", causeLabel: "Tipe Salah - Model Audio",
            desc: "Ini model audio (text-to-speech / speech-to-text), bukan text chat. Sudah difilter."
        },
        {
            provider: "PollinationsAI", model: "qwen-3guard-gen-8b",
            cause: "wrong-type", causeLabel: "Tipe Salah - Guard Model",
            desc: "Ini model content safety (guard/filter), bukan model chat. Tidak bisa dipakai untuk percakapan."
        },
        {
            provider: "PollinationsAI", model: "qwen-character",
            cause: "deprecated", causeLabel: "Model Deprecated",
            desc: "Model roleplay/character ini sudah dihapus atau tidak lagi didukung oleh provider."
        },
        {
            provider: "Perplexity", model: "claude35haiku",
            cause: "deprecated", causeLabel: "Model Deprecated",
            desc: "Claude 3.5 Haiku sudah diganti dengan Claude Haiku 4.5. Perplexity menghapus model lama ini."
        },
        {
            provider: "Perplexity", model: "mistral",
            cause: "deprecated", causeLabel: "Model Deprecated",
            desc: "Model Mistral versi lama sudah dihapus dari Perplexity. Diganti versi baru."
        },
        {
            provider: "Perplexity", model: "claude3opus",
            cause: "deprecated", causeLabel: "Model Deprecated",
            desc: "Claude 3 Opus diganti dengan Claude 4.0 Opus. Model lama menghasilkan respon kosong."
        },
        {
            provider: "PollinationsAI", model: "gpt-5.2",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon meskipun request terkirim. Provider timeout setelah 58 detik."
        },
        {
            provider: "PollinationsAI", model: "qwen-3-coder",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 46 detik."
        },
        {
            provider: "PollinationsAI", model: "mistral-small",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 60 detik."
        },
        {
            provider: "PollinationsAI", model: "gemini-2.5-flash-lite",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 127 detik."
        },
        {
            provider: "PollinationsAI", model: "deepseek-v3",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 31 detik."
        },
        {
            provider: "PollinationsAI", model: "gemini-2.5-flash-search",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 46 detik."
        },
        {
            provider: "PollinationsAI", model: "chickytutor",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 60 detik."
        },
        {
            provider: "PollinationsAI", model: "claude-haiku-4.5",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 60 detik. Kemungkinan butuh API key Anthropic."
        },
        {
            provider: "PollinationsAI", model: "sonar",
            cause: "provider", causeLabel: "Provider - No Response",
            desc: "Model tidak merespon. Provider timeout setelah 101 detik."
        }
    ];

    const DISABLED_PROVIDERS = [
        { provider: "HuggingChat", reason: "JSON decode error saat parsing response. Provider memerlukan autentikasi cookie dari browser.", cause: "auth" },
        { provider: "Copilot", reason: "Memerlukan file .har dari browser Microsoft Edge. Tidak bisa diautomasi tanpa login manual.", cause: "auth" },
        { provider: "Pi", reason: "Memerlukan package 'zendriver' untuk automasi browser. Package tidak tersedia di environment ini.", cause: "dependency" },
        { provider: "You.com", reason: "Provider sepenuhnya broken - API endpoint tidak merespon sama sekali.", cause: "down" },
        { provider: "Google Gemini", reason: "Memerlukan cookie '__Secure-1PSID' dari browser. Harus login manual ke Google.", cause: "auth" }
    ];

    function getStars(count) {
        return '<span style="color:#f5a623;letter-spacing:1px;">' + '&#9733;'.repeat(count) + '<span style="color:#ddd;">' + '&#9733;'.repeat(5 - count) + '</span></span>';
    }

    function getModelInfo(provider, model) {
        var providerData = MODEL_RATINGS[provider];
        if (!providerData) return null;
        return providerData[model] || null;
    }

    function getTierClass(tier) {
        if (tier === 'Elite') return 'tier-elite';
        if (tier === 'Strong') return 'tier-strong';
        if (tier === 'Good') return 'tier-good';
        return 'tier-basic';
    }

    function getTagClass(tag) {
        if (tag === 'coding' || tag === 'long-code') return 'good-coding';
        if (tag === 'reasoning') return 'good-reasoning';
        if (tag === 'fast') return 'fast';
        if (tag === 'search') return 'search';
        if (tag === 'budget') return 'budget';
        return '';
    }

    function getTagLabel(tag) {
        var labels = {
            'coding': 'Coding',
            'long-code': 'Kode Panjang',
            'reasoning': 'Reasoning',
            'fast': 'Cepat',
            'search': 'Search',
            'general': 'Umum',
            'budget': 'Gratis/Murah'
        };
        return labels[tag] || tag;
    }

    function switchTab(name) {
        document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
        document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
        event.target.classList.add('active');
        document.getElementById('tab-' + name).classList.add('active');
        if (name === 'catalog') renderCatalog();
    }



    function onProviderChange() {
        var provider = document.getElementById('pgProvider').value;
        var modelSelect = document.getElementById('pgModel');
        var models = PROVIDERS_MODELS[provider] || ['default'];

        modelSelect.innerHTML = '';
        models.forEach(function(m) {
            var opt = document.createElement('option');
            opt.value = m;
            var info = getModelInfo(provider, m);
            var starStr = info ? ' ' + '★'.repeat(info.stars) + '☆'.repeat(5 - info.stars) : '';
            opt.textContent = m + starStr;
            modelSelect.appendChild(opt);
        });
        onModelChange();
    }

    function onModelChange() {
        updatePreview();
        var provider = document.getElementById('pgProvider').value;
        var model = document.getElementById('pgModel').value;
        var info = getModelInfo(provider, model);
        var card = document.getElementById('modelInfoCard');

        if (info) {
            var tagsHtml = info.tags.map(function(t) {
                return '<span class="mi-tag ' + getTagClass(t) + '">' + getTagLabel(t) + '</span>';
            }).join('');

            card.innerHTML = '<div class="mi-header">' +
                '<span class="mi-name">' + model + '</span>' +
                '<span class="mi-stars">' + '★'.repeat(info.stars) + '<span style="color:#ddd;">' + '☆'.repeat(5 - info.stars) + '</span></span>' +
                '<span class="mi-tier ' + getTierClass(info.tier) + '">' + info.tier + '</span>' +
                '</div>' +
                '<div class="mi-tags">' + tagsHtml + '</div>' +
                '<div class="mi-desc">' + info.desc + '</div>';
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    }

    function updatePreview() {
        var provider = document.getElementById('pgProvider').value;
        var model = document.getElementById('pgModel').value;
        var msg = document.getElementById('pgMessage').value || 'Hello';
        var url = BASE_URL + '/';
        document.getElementById('urlPreview').textContent = 'POST ' + url + '  Body: {"text":"' + msg + '","provider":"' + provider + '","model":"' + model + '"' + (USER_TOKEN ? ',"token":"' + USER_TOKEN + '"' : '') + '}';
        var tokenField = USER_TOKEN ? ',"token":"' + USER_TOKEN + '"' : '';
        var curlPostCmd = "curl -X POST '" + BASE_URL + "/' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"text\":\"" + msg.replace(/"/g, '\\"') + "\",\"provider\":\"" + provider + "\",\"model\":\"" + model + "\"" + tokenField + "}'";
        document.getElementById('curlPreview').textContent = curlPostCmd;
    }

    function getCurlCommand(provider, model) {
        var msg = (document.getElementById('pgMessage') && document.getElementById('pgMessage').value.trim()) || 'Hello, respond with one short sentence.';
        return "curl -X POST '" + BASE_URL + "/test-api/run' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"provider\":\"" + provider + "\",\"model\":\"" + model + "\",\"message\":\"" + msg.replace(/"/g, '\\"') + "\"}'";
    }

    function copyText(text, btn) {
        navigator.clipboard.writeText(text).then(function() {
            var orig = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(function() { btn.textContent = orig; }, 1500);
        });
    }

    function setButtonsState(testing) {
        document.getElementById('runBtn').disabled = testing;
        document.getElementById('testAllModelsBtn').disabled = testing;
        document.getElementById('testAllBtn').disabled = testing;
        document.getElementById('stopBtn').style.display = testing ? '' : 'none';
    }

    async function runTest() {
        var provider = document.getElementById('pgProvider').value;
        var model = document.getElementById('pgModel').value;
        var message = document.getElementById('pgMessage').value;
        var statusEl = document.getElementById('pgStatus');
        var resultEl = document.getElementById('pgResult');
        var timeEl = document.getElementById('pgTime');

        statusEl.className = 'status-badge badge-testing';
        statusEl.textContent = 'Executing...';
        resultEl.textContent = 'Mengirim request...';
        timeEl.textContent = '';
        document.getElementById('runBtn').disabled = true;

        var startTime = Date.now();
        try {
            var res = await fetch('/test-api/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ provider: provider, model: model, message: message })
            });
            var data = await res.json();
            var elapsed = ((Date.now() - startTime) / 1000).toFixed(1);

            if (data.status === 'success') {
                statusEl.className = 'status-badge badge-success';
                statusEl.textContent = '200 OK';
                resultEl.textContent = JSON.stringify({ status: 'success', provider: data.provider, model: data.model, response: data.response }, null, 2);
            } else {
                statusEl.className = 'status-badge badge-error';
                statusEl.textContent = 'Error';
                resultEl.textContent = JSON.stringify({ status: 'error', provider: data.provider, model: data.model || model, error: data.response }, null, 2);
            }
            timeEl.textContent = 'Time: ' + elapsed + 's | Provider: ' + provider + ' | Model: ' + (data.model || model);
        } catch (err) {
            statusEl.className = 'status-badge badge-error';
            statusEl.textContent = 'Network Error';
            resultEl.textContent = JSON.stringify({ error: err.message }, null, 2);
        }
        document.getElementById('runBtn').disabled = false;
    }

    async function testSingleModel(provider, model, message) {
        var startTime = Date.now();
        try {
            var res = await fetch('/test-api/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ provider: provider, model: model, message: message })
            });
            var data = await res.json();
            var elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            return {
                provider: provider,
                model: data.model || model,
                status: data.status === 'success' ? 'success' : 'error',
                time: elapsed + 's',
                response: data.status === 'success' ? (data.response || '').substring(0, 200) : (data.response || 'No response')
            };
        } catch (err) {
            var elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
            return { provider: provider, model: model, status: 'error', time: elapsed + 's', response: err.message };
        }
    }

    function updateSummary() {
        var total = allResults.length;
        var success = allResults.filter(function(r) { return r.status === 'success'; }).length;
        var error = allResults.filter(function(r) { return r.status === 'error'; }).length;
        var pending = allResults.filter(function(r) { return r.status === 'pending'; }).length;
        var tested = success + error;

        document.getElementById('sumTotal').textContent = total;
        document.getElementById('sumSuccess').textContent = success;
        document.getElementById('sumError').textContent = error;
        document.getElementById('sumPending').textContent = pending;

        var pct = total > 0 ? Math.round((tested / total) * 100) : 0;
        document.getElementById('sumProgress').style.width = pct + '%';
        document.getElementById('sumProgressText').textContent = tested + '/' + total + ' tested (' + pct + '%)';

        var tbody = document.getElementById('resultsBody');
        tbody.innerHTML = '';
        allResults.forEach(function(r, idx) {
            var tr = document.createElement('tr');
            var badgeClass = r.status === 'success' ? 'badge-success' : (r.status === 'error' ? 'badge-error' : (r.status === 'testing' ? 'badge-testing' : (r.status === 'waiting' ? 'badge-testing' : 'badge-pending')));
            var badgeText = r.status === 'success' ? 'Success' : (r.status === 'error' ? 'Error' : (r.status === 'testing' ? 'Testing...' : (r.status === 'waiting' ? 'Waiting...' : 'Pending')));
            var info = getModelInfo(r.provider, r.model);
            var starsHtml = info ? getStars(info.stars) : '<span style="color:#999;">-</span>';
            var curlCmd = getCurlCommand(r.provider, r.model);
            var modelLink = '<a href="#" onclick="showCurlModal(\'' + r.provider.replace(/'/g,"\\'") + '\',\'' + r.model.replace(/'/g,"\\'") + '\');return false;" style="color:#034953;text-decoration:underline;cursor:pointer;font-weight:600;" title="Klik untuk lihat cURL">' + r.model + '</a>';
            tr.innerHTML = '<td><b>' + r.provider + '</b></td>' +
                '<td>' + modelLink + '</td>' +
                '<td>' + starsHtml + '</td>' +
                '<td><span class="status-badge ' + badgeClass + '">' + badgeText + '</span></td>' +
                '<td>' + (r.time || '-') + '</td>' +
                '<td><div class="response-preview">' + (r.response || '-').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div></td>';
            tbody.appendChild(tr);
        });
    }

    function sleep(ms) { return new Promise(function(resolve) { setTimeout(resolve, ms); }); }
    const RATE_LIMIT_DELAY = 13000;

    async function testAllModelsForProvider() {
        var provider = document.getElementById('pgProvider').value;
        var message = document.getElementById('pgMessage').value;
        if (!message || !message.trim()) {
            message = 'Hello, respond with one short sentence.';
        }
        var models = PROVIDERS_MODELS[provider] || ['default'];

        stopFlag = false;
        setButtonsState(true);
        allResults = [];

        models.forEach(function(m) {
            allResults.push({ provider: provider, model: m, status: 'pending', time: '', response: '' });
        });

        document.getElementById('summarySection').style.display = '';
        updateSummary();

        for (var i = 0; i < models.length; i++) {
            if (stopFlag) break;
            if (i > 0 && i % 4 === 0) {
                allResults[i].status = 'waiting';
                updateSummary();
                await sleep(RATE_LIMIT_DELAY);
                if (stopFlag) break;
            }
            allResults[i].status = 'testing';
            updateSummary();

            try {
                var result = await testSingleModel(provider, models[i], message);
                allResults[i] = result;
            } catch (err) {
                allResults[i] = { provider: provider, model: models[i], status: 'error', time: '0s', response: err.message || 'Unknown error' };
            }
            updateSummary();
        }

        setButtonsState(false);
    }

    async function testAllProviders() {
        var message = document.getElementById('pgMessage').value;
        if (!message || !message.trim()) {
            message = 'Hello, respond with one short sentence.';
        }
        var providerNames = Object.keys(PROVIDERS_MODELS);
        var totalModels = 0;
        providerNames.forEach(function(p) { totalModels += (PROVIDERS_MODELS[p] || ['default']).length; });
        console.log('testAllProviders: ' + providerNames.length + ' providers, ' + totalModels + ' models total');

        stopFlag = false;
        setButtonsState(true);
        allResults = [];

        providerNames.forEach(function(p) {
            var models = PROVIDERS_MODELS[p] || ['default'];
            models.forEach(function(m) {
                allResults.push({ provider: p, model: m, status: 'pending', time: '', response: '' });
            });
        });

        document.getElementById('summarySection').style.display = '';
        updateSummary();

        var idx = 0;
        var requestCount = 0;
        for (var pi = 0; pi < providerNames.length; pi++) {
            var provider = providerNames[pi];
            var models = PROVIDERS_MODELS[provider] || ['default'];
            for (var mi = 0; mi < models.length; mi++) {
                if (stopFlag) {
                    allResults[idx].status = 'pending';
                    idx++;
                    continue;
                }
                if (requestCount > 0 && requestCount % 4 === 0) {
                    allResults[idx].status = 'waiting';
                    updateSummary();
                    await sleep(RATE_LIMIT_DELAY);
                    if (stopFlag) {
                        allResults[idx].status = 'pending';
                        idx++;
                        continue;
                    }
                }
                allResults[idx].status = 'testing';
                updateSummary();

                try {
                    var result = await testSingleModel(provider, models[mi], message);
                    allResults[idx] = result;
                } catch (err) {
                    allResults[idx] = { provider: provider, model: models[mi], status: 'error', time: '0s', response: err.message || 'Unknown error' };
                }
                updateSummary();
                idx++;
                requestCount++;
            }
        }

        setButtonsState(false);
    }

    function stopAllTests() {
        stopFlag = true;
        setButtonsState(false);
    }

    function renderCatalog(filter) {
        var tbody = document.getElementById('catalogBody');
        tbody.innerHTML = '';
        var eliteCount = 0;
        var totalModels = 0;

        Object.keys(MODEL_RATINGS).forEach(function(provider) {
            var models = MODEL_RATINGS[provider];
            Object.keys(models).forEach(function(model) {
                var info = models[model];
                totalModels++;
                if (info.stars === 5) eliteCount++;

                if (filter && filter !== 'all') {
                    if (filter === 'coding') {
                        if (info.tags.indexOf('coding') === -1 && info.tags.indexOf('long-code') === -1) return;
                    } else if (typeof filter === 'number' && info.stars !== filter) {
                        return;
                    }
                }

                var tr = document.createElement('tr');
                var tagsHtml = info.tags.map(function(t) {
                    return '<span class="mi-tag ' + getTagClass(t) + '">' + getTagLabel(t) + '</span>';
                }).join(' ');
                var modelLink = '<a href="#" onclick="showCurlModal(\'' + provider.replace(/'/g,"\\'") + '\',\'' + model.replace(/'/g,"\\'") + '\');return false;" style="color:#034953;text-decoration:underline;cursor:pointer;font-weight:700;" title="Klik untuk lihat cURL">' + model + '</a>';

                tr.innerHTML = '<td><b>' + provider + '</b></td>' +
                    '<td>' + modelLink + '</td>' +
                    '<td>' + getStars(info.stars) + '</td>' +
                    '<td><span class="mi-tier ' + getTierClass(info.tier) + '">' + info.tier + '</span></td>' +
                    '<td>' + tagsHtml + '</td>' +
                    '<td style="font-size:11px;color:#555;max-width:250px;">' + info.desc + '</td>';
                tbody.appendChild(tr);
            });
        });

    }

    function filterCatalog(filter) {
        renderCatalog(filter);
    }

    function showCurlModal(provider, model) {
        var msg = 'Hello, respond with one short sentence.';
        var pgMsg = document.getElementById('pgMessage');
        if (pgMsg && pgMsg.value.trim()) msg = pgMsg.value.trim();

        var tokenField = USER_TOKEN ? ',"token":"' + USER_TOKEN + '"' : '';
        var curlPost = "curl -X POST '" + BASE_URL + "/' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"text\":\"" + msg.replace(/"/g, '\\"') + "\",\"provider\":\"" + provider + "\",\"model\":\"" + model + "\"" + tokenField + "}'";
        var curlStream = "curl -X POST '" + BASE_URL + "/stream' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"text\":\"" + msg.replace(/"/g, '\\"') + "\",\"provider\":\"" + provider + "\",\"model\":\"" + model + "\"" + tokenField + "}'";

        var modal = document.getElementById('curlModal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'curlModal';
            document.body.appendChild(modal);
        }

        modal.innerHTML = '<div class="curl-modal-overlay" onclick="closeCurlModal()"></div>' +
            '<div class="curl-modal-content">' +
            '<div class="curl-modal-header"><span class="curl-modal-title">' + provider + ' / ' + model + '</span>' +
            '<button onclick="closeCurlModal()" style="background:none;border:none;font-size:22px;cursor:pointer;color:#666;line-height:1;">&times;</button></div>' +
            '<div class="curl-modal-body">' +

            '<div class="curl-section">' +
            '<div class="curl-section-label"><span class="curl-method-tag">POST</span> API Response (teks biasa)</div>' +
            '<div class="curl-code-box" id="curlBox1">' + escHtml(curlPost) +
            '<button class="curl-copy-btn" onclick="copyCurl(\'curlBox1\',this)">Copy</button></div></div>' +

            '<div class="curl-section">' +
            '<div class="curl-section-label"><span class="curl-method-tag" style="background:#17a2b8;">POST SSE</span> Streaming Response (real-time)</div>' +
            '<div class="curl-code-box" id="curlBox2">' + escHtml(curlStream) +
            '<button class="curl-copy-btn" onclick="copyCurl(\'curlBox2\',this)">Copy</button></div></div>' +

            '<div style="margin-top:10px;padding:10px;background:#f0f7f8;border-radius:8px;font-size:11px;color:#555;line-height:1.6;">' +
            '<b style="color:#034953;">Catatan:</b> Semua endpoint menggunakan POST method dengan JSON body. ' +
            'Copy cURL di atas untuk menggunakan model <b>' + model + '</b> dari <b>' + provider + '</b>.' +
            '</div>' +

            '</div></div>';

        modal.style.display = 'flex';
    }

    function escHtml(s) {
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function closeCurlModal() {
        var modal = document.getElementById('curlModal');
        if (modal) modal.style.display = 'none';
    }

    function copyCurl(boxId, btn) {
        var box = document.getElementById(boxId);
        if (!box) return;
        var text = box.textContent.replace('Copy','').replace('Copied!','').trim();
        navigator.clipboard.writeText(text).then(function() {
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(function() {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
        }).catch(function() {
            var ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed';
            ta.style.opacity = '0';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(function() {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
        });
    }

    onProviderChange();
    </script>
</body>
</html>
